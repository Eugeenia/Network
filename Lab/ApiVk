import socket
import requests
import re
import time

class Api:
    def __init__(self):
        self.token = input('Input your token: ')

    def make_request(self, method):
        req = requests.get('https://api.vk.com/method/{}?access_token={}&v=5.74'.format(method, self.token))
        return req.text

    def get_friends(self, method):
        string = self.make_request(method)
        friends = self.get_list(string)[1:]
        return friends

    def get_list(self, resp):
        resp = re.findall(r'[0-9]*', resp)
        # print(resp)
        list_ = []
        for f in resp:
            if f:
                list_.append(f)
        return list_

    def get_mutual_friends(self, method):
        mutual = dict()
        friends = self.get_friends(method)
        mut = []
        for f in friends:
            if f:
                m = requests.get('https://api.vk.com/method/{}?access_token={}&target_uid={}&v=5.74'.
                                 format('friends.getMutual', self.token, f))
                time.sleep(1)
                mutual[f] = self.get_list(m.text)
        return mutual

    def get_most(self, method):
        friends = self.get_mutual_friends(method)
        maximum = 0
        most = None
        for key in friends:
            if len(friends[key]) > maximum:
                maximum = len(friends[key])
                most = key
        most = requests.get('https://api.vk.com/method/{}?user_ids={}&access_token={}&v=5.74'.
                            format('users.get', most, self.token)).text
        most_ = re.findall(r'([А-Яа-яёЁ]*)', most)
        friend = ''
        for f in most_:
            if f:
                friend += f + ' '
        return friend, maximum


a = Api()
print('Most: {}'.format(a.get_most('friends.get')))
